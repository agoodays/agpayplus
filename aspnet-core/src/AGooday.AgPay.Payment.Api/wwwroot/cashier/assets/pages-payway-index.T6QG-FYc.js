import{_ as e,u as t,c as a,r as o,a as s,b as n,d as l,w as r,i as d,o as i,e as h,f as c,n as u,g as m,t as p,p as y,q as f,F as g,v as k,k as T,I as w,h as _}from"./index-Cfcg06QB.js";import{b as C}from"./index.iuDkB73E.js";const b=e({data:()=>({amount:"0",pressedKey:null,isShowModel:!1,isPaying:!1,remark:null,showRemark:null,numKeys:["1","2","3","4","5","6","7","8","9",".","0"],funKeys:["del","C"],payOrderInfo:{},channelUserId:"",token:"",payWay:{},themeColor:"",isMiniProgram:!1,contentPaddingTop:0,fixedTopBgHeight:6.625*t(33.28)}),onLoad(){console.log(a),this.themeColor=a.themeColor,this.isMiniProgram=a.isMiniProgram,this.channelUserId=a.channelUserId,this.token=a.tokenValue,this.payWay=a.payWay;const e=this;C({token:a.tokenValue}).then((t=>{e.payOrderInfo=t,e.amount=t.amount/100+"",t.payOrderId&&e.handlePayment()})).catch((t=>{e.redirectToError(t.msg)}))},computed:{formattedAmount(){return this.amount?parseFloat(this.amount).toFixed(2):"0.00"},totalTopBgHeight(){return this.contentPaddingTop+this.fixedTopBgHeight}},methods:{handleHeaderHeight(e){this.contentPaddingTop=e},redirectToError(e){o({url:`/pages/error/index?errInfo=${e}`})},toggleRemarkModal(e=!0){this.isShowModel=e},handleRemark(){this.showRemark=this.remark,this.isShowModel=!1},formatAmount(){return(e=>{if(null==e)return"";const t=e.toString().trim();if(""===t)return"";let a="",o=t;t.startsWith("-")&&(a="-",o=t.slice(1));const s=o.split(".");let n=s[0]||"0";const l=s[1]||"";let r="";for(;n.length>3;)r=`,${n.slice(-3)}${r}`,n=n.slice(0,-3);r=n+r;let d=`${a}${r}`;return l?d+=`.${l}`:t.endsWith(".")&&(d+="."),d})(this.amount)},handleTouchStart(e){this.pressedKey=e,this.handleKeyPress(e)},handleTouchEnd(){this.pressedKey=null},handleKeyPress(e){"pay"!==e&&1===this.payOrderInfo.fixedFlag&&this.payOrderInfo.amount>0||("del"===e?(this.amount=this.amount.slice(0,-1),this.amount||(this.amount="0")):"C"===e?this.amount="0":"pay"===e?this.isPaying||this.handlePayment():/[0-9.]/.test(e)&&this.handleNumberInput(e))},handleNumberInput(e){if("."===e){if(this.amount.includes("."))return;return"0"===this.amount||""===this.amount?void(this.amount="0."):void(-1===this.amount.indexOf(".")&&(this.amount+="."))}const t=this.amount.replace(/^0+(?=\d)/,"");if(parseFloat(t+e)>=1e7)s({title:"金额不能超过千万",icon:"none"});else{if(this.amount.includes(".")){if((this.amount.split(".")[1]||"").length>=2)return}this.amount="0"===t?e:this.amount+e}},async handlePayment(){console.log({amount:this.amount,formattedAmount:this.formattedAmount})},getOrderInfo(e){switch(this.payWay.wayType){case"wxpay":return e.payInfo;case"alipay":case"ysfpay":return e.alipayTradeNo;default:return null}},validateAmount(){return!(!this.amount||parseFloat(this.amount)<=0)||(s({title:"请输入有效金额",icon:"none"}),!1)}}},[["render",function(e,t,a,o,s,C){const b=n("CustomHeader"),v=d,x=T,H=_,I=w;return i(),l(v,{class:"container"},{default:r((()=>[s.isMiniProgram?(i(),l(b,{key:0,title:"收银台",bgColor:s.themeColor,onHeaderHeight:C.handleHeaderHeight},null,8,["bgColor","onHeaderHeight"])):h("",!0),c(v,{class:"content",style:u({paddingTop:s.contentPaddingTop+"px"})},{default:r((()=>[c(v,{class:"content-top-bg",style:u({height:C.totalTopBgHeight+"px",backgroundColor:s.themeColor})},null,8,["style"]),c(v,{class:"payment"},{default:r((()=>[c(v,{class:"payment-mchName"},{default:r((()=>[m("付款给 "+p(s.payOrderInfo.mchName),1)])),_:1}),c(v,{class:"payment-divider"}),c(v,{class:"payment-amountTips"},{default:r((()=>[m("付款金额：")])),_:1}),c(v,{class:"payment-amount",style:u({color:s.themeColor})},{default:r((()=>[c(x,{class:"payment-amount-rmb"},{default:r((()=>[m("￥")])),_:1}),c(x,{class:"payment-amount-value"},{default:r((()=>[m(p(C.formatAmount(s.amount)),1)])),_:1})])),_:1},8,["style"])])),_:1}),c(v,{class:"payment-keyboard"},{default:r((()=>[c(x,{class:"buyer-remark",onTouchstart:t[0]||(t[0]=e=>this.isShowModel=!0)},{default:r((()=>[m(p(s.showRemark)+" ",1),c(x,{style:u({color:s.themeColor})},{default:r((()=>[m(p(s.showRemark?"修改":"添加备注"),1)])),_:1},8,["style"])])),_:1}),c(v,{class:"ag-keyboard"},{default:r((()=>[c(v,{class:"left"},{default:r((()=>[(i(!0),y(g,null,f(s.numKeys,((e,a)=>(i(),l(v,{key:a,class:k(["common",{zero:["0"].includes(e),"hover-but":s.pressedKey===e}]),onTouchstart:t=>C.handleTouchStart(e),onTouchend:t[1]||(t[1]=e=>C.handleTouchEnd())},{default:r((()=>[m(p(e),1)])),_:2},1032,["class","onTouchstart"])))),128))])),_:1}),c(v,{class:"right"},{default:r((()=>[(i(!0),y(g,null,f(s.funKeys,((e,a)=>(i(),l(v,{key:a,class:k(["common del",{"hover-but":s.pressedKey===e}]),onTouchstart:t=>C.handleTouchStart(e),onTouchend:t[2]||(t[2]=e=>C.handleTouchEnd())},{default:r((()=>["del"===e?(i(),l(H,{key:0,src:"data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1670332843052'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='2668'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M874.666667%20202.666667H360.533333c-21.333333%200-40.533333%208.533333-55.466666%2023.466666l-217.6%20234.666667c-25.6%2027.733333-25.6%2072.533333%200%20100.266667l217.6%20234.666666c14.933333%2014.933333%2034.133333%2023.466667%2055.466666%2023.466667H874.666667c40.533333%200%2074.666667-34.133333%2074.666666-74.666667V277.333333c0-40.533333-34.133333-74.666667-74.666666-74.666666z%20m10.666666%20544c0%206.4-4.266667%2010.666667-10.666666%2010.666666H360.533333c-2.133333%200-6.4-2.133333-8.533333-4.266666l-217.6-234.666667c-4.266667-4.266667-4.266667-10.666667%200-14.933333l217.6-234.666667c2.133333-2.133333%204.266667-4.266667%208.533333-4.266667H874.666667c6.4%200%2010.666667%204.266667%2010.666666%2010.666667V746.666667z'%20p-id='2669'%3e%3c/path%3e%3cpath%20d='M684.8%20403.2c-12.8-12.8-32-12.8-44.8%200l-64%2064-61.866667-61.866667c-12.8-12.8-32-12.8-44.8%200-12.8%2012.8-12.8%2032%200%2044.8l61.866667%2061.866667-61.866667%2061.866667c-12.8%2012.8-12.8%2032%200%2044.8%206.4%206.4%2014.933333%208.533333%2023.466667%208.533333s17.066667-2.133333%2023.466667-8.533333l61.866666-61.866667L640%20618.666667c6.4%206.4%2014.933333%208.533333%2023.466667%208.533333s17.066667-2.133333%2023.466666-8.533333c12.8-12.8%2012.8-32%200-44.8L620.8%20512l61.866667-61.866667c12.8-12.8%2012.8-34.133333%202.133333-46.933333z'%20p-id='2670'%3e%3c/path%3e%3c/svg%3e"})):(i(),l(x,{key:1},{default:r((()=>[m(p(e),1)])),_:2},1024))])),_:2},1032,["class","onTouchstart"])))),128)),c(v,{class:k(["common pay",{"hover-but":"pay"===s.pressedKey}]),style:u({backgroundColor:s.themeColor}),onTouchstart:t[3]||(t[3]=e=>C.handleTouchStart("pay")),onTouchend:t[4]||(t[4]=e=>C.handleTouchEnd())},{default:r((()=>[m("付款")])),_:1},8,["style","class"])])),_:1})])),_:1})])),_:1}),s.isShowModel?(i(),l(v,{key:0,class:"remark-model"},{default:r((()=>[c(v,{class:"remark-content"},{default:r((()=>[c(v,{class:"remark-content-title",style:u({color:s.themeColor})},{default:r((()=>[m(" 添加备注 ")])),_:1},8,["style"]),c(I,{placeholder:"最多输入12个字",class:"remark-content-body",modelValue:s.remark,"onUpdate:modelValue":t[5]||(t[5]=e=>s.remark=e)},null,8,["modelValue"]),c(v,{class:"remark-content-btn"},{default:r((()=>[c(x,{class:"btn-cancel",onTouchstart:t[6]||(t[6]=e=>s.isShowModel=!1)},{default:r((()=>[m("取消")])),_:1}),c(x,{class:"btn-confirm",style:u({backgroundColor:s.themeColor,borderColor:s.themeColor}),onTouchstart:t[7]||(t[7]=e=>C.handleRemark())},{default:r((()=>[m("确认")])),_:1},8,["style"])])),_:1})])),_:1})])),_:1})):h("",!0)])),_:1},8,["style"])])),_:1})}],["__scopeId","data-v-cdaf5a43"]]);export{b as default};
